Add a complete, secure, production-ready Delivery Partner system where Admin can create/verify/manage delivery partners and assign/withdraw delivery duties by zone — delete all mock data and replace with real persisted records.

1) High-level flow (user stories)

Admin opens /admin/delivery → clicks Add Delivery Partner → fills partner details (name, phone, email, address, Aadhaar image, PAN image, driving license, photo) → saves as Pending Verification.

Admin reviews documents, verifies identity, and either Approve or Reject. On approve, Admin creates credentials (username + temporary password) and optionally triggers an SMS/email to partner with login details.

Admin assigns partner to one or more Zones (e.g., Bandra, Santacruz, Andheri). A partner can have active, blocked, suspended, pending_verification.

Admin can block/unblock partner instantly — blocked partners cannot login/accept tasks.

Admin assigns orders/deliveries to partners by zone or manually. Partner receives assignments in the Delivery Partner App.

Delivery partner logs into delivery app using issued credentials, views today's routes, marks pickup/delivered, uploads proof, and views earnings.

All mock data removed; DB seeded with real, admin-provided test accounts only.

2) Database schema (Postgres) — tables & key fields
-- delivery_partners table
CREATE TABLE delivery_partners (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  full_name TEXT NOT NULL,
  email TEXT UNIQUE,
  phone VARCHAR(15) UNIQUE NOT NULL,
  username TEXT UNIQUE,
  password_hash TEXT, -- bcrypt
  status TEXT NOT NULL DEFAULT 'pending_verification', -- pending_verification | active | suspended | blocked | rejected
  aadhaar_image_url TEXT,
  pan_image_url TEXT,
  license_image_url TEXT,
  profile_image_url TEXT,
  address JSONB,
  assigned_zones TEXT[], -- e.g. ['Bandra','Santacruz']
  assigned_orders INT[], -- optional array or refer order_assignments table
  created_at TIMESTAMP DEFAULT now(),
  updated_at TIMESTAMP DEFAULT now(),
  verified_by UUID NULL, -- admin id
  verified_at TIMESTAMP NULL,
  is_deleted BOOLEAN DEFAULT FALSE
);

-- order_assignments table (many-to-many)
CREATE TABLE order_assignments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_id UUID REFERENCES orders(id) ON DELETE CASCADE,
  partner_id UUID REFERENCES delivery_partners(id) ON DELETE SET NULL,
  assigned_by UUID,
  assigned_at TIMESTAMP DEFAULT now(),
  status TEXT DEFAULT 'assigned', -- assigned | accepted | picked_up | delivered | failed
  picked_up_at TIMESTAMP,
  delivered_at TIMESTAMP,
  proof_photo_url TEXT,
  notes TEXT
);

-- admin_actions log (audit)
CREATE TABLE admin_actions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID,
  action TEXT,
  target_type TEXT,
  target_id UUID,
  payload JSONB,
  created_at TIMESTAMP DEFAULT now()
);


Note: Use UUIDs and proper constraints. Store images as URLs (S3 / Cloud Storage). For local dev, use /uploads/....

3) API endpoints (REST) — backend responsibilities
Auth & Partner lifecycle

POST /api/admin/delivery-partners — Create new partner (Admin). Payload: { full_name, email, phone, address, assigned_zones[], documents: {aadhaar, pan, license, profile} } (multipart/form-data)

GET /api/admin/delivery-partners — List partners (filter by status, zone, search)

GET /api/admin/delivery-partners/:id — Get partner detail + documents

PUT /api/admin/delivery-partners/:id — Update partner details (admin)

PATCH /api/admin/delivery-partners/:id/verify — Approve or Reject. Payload: {action: 'approve'|'reject', note, setUsername: 'bp_boy001', tempPassword: 'AutoGeneratedStrongPass123'} — on approve: hash password, set status active, set verified_by, verified_at.

PATCH /api/admin/delivery-partners/:id/block — {action: 'block'|'unblock', reason}

DELETE /api/admin/delivery-partners/:id — Soft-delete is_deleted=true.

Assignment & Management

POST /api/admin/order-assignments — Assign order(s) to partner: {partner_id, order_ids[], assigned_by}

GET /api/admin/order-assignments?zone=Bandra — assignments list by zone/status

PATCH /api/admin/order-assignments/:id — Update assignment e.g., reassign or cancel

Delivery partner app APIs

POST /api/partner/login — login by username/password

GET /api/partner/me — profile

GET /api/partner/assignments?date=today — list assignments for partner

PATCH /api/partner/assignments/:id/accept — accept assignment

PATCH /api/partner/assignments/:id/pickup — mark picked up

PATCH /api/partner/assignments/:id/deliver — mark delivered with proof photo

GET /api/partner/earnings?month=YYYY-MM — summary

Admin quick checks

GET /api/admin/zones — list zones (seeded)

POST /api/admin/zones — create new zone

4) File storage & upload

Use S3, DigitalOcean Spaces or Replit persistent storage. Accept multipart/form-data uploads.

Validate file type (jpg/png/pdf), max size (e.g., 5MB).

Store only URLs in DB.

Generate thumbnail for preview.

5) Frontend pages & components
Admin UI — /admin/delivery

List view: Table with columns: Photo, Name, Phone, Email, Status (label), Zones, Verified (✓), Assigned Orders count, Actions (View / Verify / Block / Edit / Delete).

Add partner modal (form): fields for name, phone, email, address (structured), assigned zones (multi-select), upload documents (Aadhaar, PAN, License, profile photo). Submit calls POST /api/admin/delivery-partners.

Partner detail view: Shows provided docs as thumbnails (click to expand), timeline of admin actions, verification form with Approve/Reject, input for username & temp password, and "Send Credentials" checkbox.

Assignment UI: On order detail page, "Assign Delivery Partner" -> filter partners by zone & status -> assign -> shows success toast and assignment appears in partner's dashboard.

Block/Unblock: Action button with confirmation modal. Blocked partners show red badge and cannot accept assignment.

Design: Reuse Admin theme; mobile responsive. Provide clear verification status badges:

Pending Verification (amber)

Active (green)

Blocked (red)

Rejected (gray)

Suspended (orange)

Delivery Partner App — /partner (mobile-first)

Login: username & password + Forgot password (admin can reset)

Home: Today’s assignments list (cards). Each card shows order id, pickup address, delivery address, items, customer phone, scheduled delivery time, earnings for delivery.

Assignment detail: Accept / Reject button. Once accepted, show route button (link to Google Maps with coords), Picked Up button (timestamp), Delivery button (upload proof photo + customer signature optional), Leave Note.

Earnings: Summary of completed earnings, payout status.

Profile: Partner can update phone (only after admin approval), view documents (read-only), change password.

Status Toggle: Online / Offline (affects availability).

Notifications: New assignment push notification (or in-app toast).

UI: Very mobile friendly, large touch targets.

6) Security & validation

Passwords: bcrypt with salt rounds >= 10.

Auth: Session or JWT (use HTTP-only cookies if session-based).

Role-based middleware: adminOnly, partnerOnly.

File uploads: virus scan if possible; restrict extensions and content-type; store with randomized names.

Rate limit login endpoints.

Two-step verify: Admin must approve/verify identity before partner can function.

Audit log: record every admin action for compliance.

Blocked partners must be immediately logged out (invalidate sessions): implement session table with partner_id — on blocking, delete partner sessions.

7) Remove mock data & seed real data (step-by-step)

1. Backup: Dump current DB.

pg_dump -U $DB_USER -d $DB_NAME -Fc -f backup_pre_delivery_feature.dump


2. Remove mock rows (careful — run in dev/staging first):

DELETE FROM delivery_partners WHERE is_mock = TRUE; -- if you flagged mock rows
-- If no flag, filter by test emails (e.g., %example.com)
DELETE FROM delivery_partners WHERE email LIKE '%example.com';


3. Seed production-ready test data (admin-provided):

INSERT INTO delivery_partners (full_name, email, phone, username, password_hash, status, assigned_zones)
VALUES ('Rajesh Kumar','rajesh+dp1@yourdomain.com','+919876543210','rajesh.dp','<bcrypt-hash>','active', ARRAY['Bandra']);


Better: create a seed script (Node/TypeScript) that reads seeds/delivery_partners.json and inserts hashed passwords.

4. Clear mock assignments

DELETE FROM order_assignments WHERE assigned_by = '<mock-admin-id>';


5. End-to-end test seed

Create 3 partners assigned to ['Bandra'], ['Santacruz'], ['Andheri'].

Insert 10 live orders in those zones and create assignments.

8) Acceptance criteria / tests
Manual tests

Admin creates partner with docs → status pending_verification → attempt login (should fail).

Admin approves and provides username/password → partner receives credentials via email/SMS → partner login success and account active.

Admin assigns order to partner by zone → partner sees assignment and can accept.

Partner accepts → picks up → delivers with proof → status updates to delivered and order marked delivered.

Admin blocks partner → partner session invalidated and cannot accept new assignments.

Attempt to reassign blocked partner → API should refuse.

File uploads can be previewed and are accessible by admin only.

Mock data removal: no example.com or mock rows exist.

Automated tests (suggest)

Unit tests for partner creation/verification endpoints.

Integration tests for assignment lifecycle.

E2E test simulating admin→partner flow using Playwright.

9) Notifications & communication

On approve: send SMS/email with username & temporary password and link to partner app. (Use Twilio/email provider; for now, create a mock that logs to server console.)

On assign: push in-app notification to partner; optionally send SMS if offline.

On block: notify partner via email + in-app.

10) Admin UX copy & flows (copy ready)

Use these copy strings in UI:

Add Partner Modal Title: Register New Delivery Partner

Submit button: Create Partner (Pending Verification)

Verification CTA (in partner detail): Approve & Issue Credentials with note: Username will be created as: <auto> or customize. Temporary password will be emailed and must be changed on first login.

Block button tooltip: Block partner — prevents login and assignment

Assign order button: Assign to Delivery Partner

11) Implementation milestones (sprint plan)

Sprint 1 (2–3 days)

DB migration + schema

File upload endpoints + cloud storage integration

Admin UI: add partner form + list + detail view

Partner table CRUD APIs

Sprint 2 (2–3 days)

Verification flow (approve/reject) + credential generation

Block/unblock + session invalidation

Remove mock data + seed real partner accounts

Admin assignment UI to assign orders by zone

Sprint 3 (2–3 days)

Partner app: login, assignments list, accept/pickup/deliver endpoints & UI

Proof photo upload

Notifications (in-app; SMS/email placeholders)

Tests & QA

12) Sample request & payloads

Create partner (Admin) — multipart

POST /api/admin/delivery-partners
Content-Type: multipart/form-data
Fields:
  full_name=Ramesh Kumar
  email=ramesh.dp@yourdomain.com
  phone=+919812345678
  address={"line1":"Street", "city":"Mumbai", "pincode":"400050"}
  assigned_zones[]=Bandra
Files:
  aadhaar=File
  pan=File
  license=File
  profile=File


Approve partner

PATCH /api/admin/delivery-partners/:id/verify
{
  "action": "approve",
  "username": "ramesh.dp",
  "tempPassword": "AutoGen#2345",
  "note": "Docs verified by admin"
}


Partner login

POST /api/partner/login
{
  "username": "ramesh.dp",
  "password": "AutoGen#2345"
}


Assign order

POST /api/admin/order-assignments
{
  "partner_id": "uuid",
  "order_ids": ["order-uuid-1", "order-uuid-2"],
  "assigned_by": "admin-uuid"
}

13) Rollout & migration checklist

 Run DB migration on staging

 Remove mock data on staging and seed real data

 Deploy backend & run smoke tests

 Deploy admin UI and test add/verify/assign flows

 Deploy partner app to staging (mobile responsive)

 Run full E2E tests

 Prepare admin training doc for verifying partners & assigning zones

 When ready, repeat on production during maintenance window

14) Replit-ready prompt (paste this into Replit AI / code assistant)

Build a full Delivery Partner management feature (frontend + backend + DB) for Divine Naturals. Requirements:

DB schema: delivery_partners, order_assignments, admin_actions as specified above (use UUID primary keys).

Admin APIs: create/list/get/update/verify/block/delete partners; create/list/assign order assignments.

Delivery Partner APIs: login, get assignments, accept/pickup/deliver/update proof, earnings.

Admin UI: /admin/delivery list, add modal, detail view with document previews, verify modal to set username/temp password, assign orders UI, block/unblock controls, audit log.

Partner App (mobile-first): login, assignments list (today), assignment detail with accept/picked up/deliver flow, proof upload, online/offline toggle, profile.

File uploads: store images in S3 / persistent storage; only store URLs; validate types and sizes.

Security: bcrypt password hashing, adminOnly/partnerOnly middleware, session invalidation on block, rate-limited auth, audit logging.

Remove existing mock delivery_partner rows (delete by email LIKE '%example.com') and seed three real partners assigned to ['Bandra'], ['Santacruz'], ['Andheri'] with hashed passwords. Provide seed script.

Provide unit/integration tests for lifecycle and E2E Playwright script simulating admin->partner flow.

Provide API documentation (OpenAPI or Postman collection) and an admin training doc for verifying partners and assigning orders.

Include sample SQL migrations, sample seed script, code snippets for endpoints and frontend components (React + Tailwind), and acceptance tests. Prioritize correctness, data validation, and auditability.

15) Final notes & priorities (what to build first)

DB migration + uploads — foundation.

Admin create/list/verify + UI — so admins can onboard partners.

Partner login + session + block/unblock — security.

Order assignment flow — connect admin + partner.

Delivery partner app (mobile) — day-to-day operations.

Remove mock data & seed real accounts — ensure production-ready.

Tests & audit logs — compliance.