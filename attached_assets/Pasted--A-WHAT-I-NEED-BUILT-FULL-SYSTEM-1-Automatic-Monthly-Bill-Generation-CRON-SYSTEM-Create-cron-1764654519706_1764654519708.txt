âœ… A. WHAT I NEED BUILT (FULL SYSTEM)
1. Automatic Monthly Bill Generation (CRON SYSTEM)

Create cron job / scheduler that:

Runs on the 1st of every month at 00:05 AM

Generates bills for every active user for previous month

Collect these items:

All subscription deliveries

All product orders in that month

Previous unpaid bill amount

Penalty (if overdue > 5 days)

Sets:

billStatus = "unpaid"

dueDate = bill.generatedAt + 5 days

totalAmount = orders + subscriptions + penalty âˆ’ discounts

previousDue = unpaid amount from last bill

Cron File:
server/cron/generateMonthlyBills.ts

2. Backend API â€” Admin Controls (FULL CRUD)

Create/update file:
server/routes/billing.routes.ts

Add these routes:

ADMIN ROUTES

GET /admin/bills

get all bills

filter by: status, month, year, userId

PATCH /admin/bills/:billId/pay

mark bill as paid

set paidAt = now

set paymentMethod = "cash"

PATCH /admin/bills/:billId/extend-due

extend due date (admin chooses days)

PATCH /admin/bills/:billId/add-penalty

add penalty amount

update totalAmount

PATCH /admin/bills/:billId/add-discount

reduce bill

update totalAmount

GET /admin/bills/:billId

full breakdown (orders + subscription deliveries)

All routes must use Drizzle ORM queries.

ðŸ§â€â™‚ï¸ B. USER BILLING PAGES (FRONTEND)

Create new folder:
client/src/pages/billing/

Build these pages:

1. /billing (User Billing Dashboard)

Show:

Current Month Bill Card

Month & Year

Total Amount

Status badge (unpaid / paid / overdue)

Due date

â€œDownload PDF Invoiceâ€

â€œMark As Paid (Cash)â€ button

Previous Bills List

Table:

| Month | Amount | Status | Paid On | Download |

2. /billing/:billId (Bill Detail Page)

Show full bill breakdown:

Bill Summary

Month

User name & address

Total amount

Status badge

Table: Bill Line Items

| Date | Description | Qty | Price | Total |

Buttons

Download PDF

Back

ðŸ“„ C. ADMIN BILLING PAGES (FRONTEND)

Route: /admin/billing

Create full admin page showing:

Top Filters

Status: Unpaid, Paid, Overdue

Month/Year dropdown

Search by User

Bills Table

Columns:

| Bill ID | Customer | Month | Amount | Status | Due Date | Actions |

Actions:

Mark Paid

Extend Due Date

Add Penalty

Add Discount

View Bill

ðŸ“„ D. PDF INVOICE GENERATION

Create backend utility:

server/utils/generateInvoice.ts

Invoice must contain:

Customer name

Address

Bill month & year

Bill ID

Due Date

Summary section

Table of charges

Total payable

Status

Use HTML template â†’ convert to PDF using:

html-pdf OR pdf-lib OR puppeteer (your choice)

Create route:

GET /bills/:billId/pdf

Frontend downloads file.

ðŸ§  E. DATABASE â€” ENSURE THESE FIELDS EXIST

In bills table:

id

userId

month

year

orderAmount

subscriptionAmount

penalty

discount

previousDue

totalAmount

status (â€œunpaidâ€, â€œpaidâ€, â€œoverdueâ€)

dueDate

paidAt

paymentMethod

createdAt

If missing fields â†’ add via migration.

ðŸ” F. BILL STATUS AUTO-UPDATE LOGIC

Every day at 02:00 AM:

If bill.status == "unpaid" AND today > dueDate
â†’ bill.status = "overdue"

ðŸŽ¨ G. FRONTEND UI STYLING

Use same styles as:

Shop page

Admin dashboard

Billing mock pages

Use Shadcn UI:

Cards

Tables

Badges

Buttons

Dialogs

ðŸ§ª H. EVERYTHING MUST WORK END-TO-END

âœ“ Bill created automatically
âœ“ Stored in database
âœ“ Shown in admin panel
âœ“ Shown in user app
âœ“ Admin can edit
âœ“ User can download PDF
âœ“ Status updates daily
âœ“ Admin can mark as paid