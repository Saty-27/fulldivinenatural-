âš¡ TASK:

Build a complete monthly billing system for a dairy shop application.
The system must be fully functional, integrated with backend + database, and visible on User side + Admin side.

Focus:
âœ” Cash-only payments (no Razorpay).
âœ” Bills must be auto-generated every month.
âœ” Bills must calculate all subscriptions + orders.
âœ” Admin must manage all bills with full control.

ğŸ“Œ 1. DATABASE STRUCTURE (PostgreSQL + Drizzle)

Create or update these tables:

bills
column	type
id	serial pk
userId	integer (fk users.id)
month	text (YYYY-MM)
totalAmount	integer
previousDue	integer
grandTotal	integer
status	text â†’ ('unpaid', 'paid', 'overdue')
generatedAt	timestamp
dueDate	timestamp
paidAt	timestamp (nullable)
billItems
column	type
id	serial pk
billId	integer (fk bills.id)
type	text ('subscription' or 'order')
relatedId	integer (subscriptionId or orderId)
date	date
description	text
quantity	numeric
price	integer
total	integer
ğŸ“Œ 2. BACKEND LOGIC (Node + Express + Drizzle)
A. Monthly Bill Generator (CRON JOB)

Create a cron process that runs at 11:59 PM on the last day of every month.

For each user:

Get all subscription deliveries of that month

Get all orders placed that month

Sum all totals

Add previous unpaid bill

Create new bill in table bills

Create billItems for each delivery/order

Set:

status = 'unpaid'

dueDate = generatedAt + 5 days

B. API ENDPOINTS
User APIs
GET /api/billing
GET /api/billing/:billId
POST /api/billing/pay/:billId  â† CASH ONLY (mark paid)

Admin APIs
GET /api/admin/billing
GET /api/admin/billing/:billId
PATCH /api/admin/billing/:billId/status    â† paid / unpaid / overdue
PATCH /api/admin/billing/:billId/extend    â† extend due date
PATCH /api/admin/billing/:billId/update    â† reduce amount, add penalty

ğŸ“Œ 3. USER SIDE PAGES
Page: /billing

Show:

Section 1 â€” Current Month Bill

Month name

Total amount

Due date (5 days limit)

Status badge:

ğŸŸ¥ Overdue

ğŸŸ§ Unpaid

ğŸŸ© Paid

Button: Mark as Paid (Cash)

Section 2 â€” Bill Breakdown

Table:

| Date | Description | Qty | Price | Total |

Section 3 â€” Previous Bills

List of past 12 months:

| Month | Amount | Status | View |

Section 4 â€” Download PDF

Button: "Download Invoice" (simple HTML-to-PDF)

ğŸ“Œ 4. ADMIN PANEL PAGES
Page: /admin/billing
Top Filters

All Bills

Paid

Unpaid

Overdue

Table of All Bills

| User | Month | Amount | Due Date | Status | Action |

Action Buttons (Admin Controls)

Per bill:

âœ” Mark as Paid

PATCH â†’ /api/admin/billing/:billId/status

âœ” Extend Due Date

Modal:

Input: New due date

Submit â†’ update bill

âœ” Add Penalty

Modal:

Input: penalty amount

Append to bill total

Update grandTotal

âœ” Reduce Amount / Give Discount

Modal:

Input: discount

Update grandTotal

âœ” View Details

Open bill detail page like user view.

ğŸ“Œ 5. BILL GENERATION LOGIC
Formula:
subscriptionDeliveriesTotal = SUM( qty * price )
ordersTotal = SUM( orderItems.price )
totalAmount = subscriptionDeliveriesTotal + ordersTotal
grandTotal = totalAmount + previousDue

Bill Conditions:

If currentDate > dueDate AND status = 'unpaid':
â†’ automatically set status = "overdue"

ğŸ“Œ 6. PDF TEMPLATE

Make a simple invoice:

DIVINE NATURALS â€“ MONTHLY INVOICE
Customer: [name]
Month: [YYYY-MM]
Generated On: [date]

Items:
-------------------------------------------------
Date | Description | Qty | Rate | Total
-------------------------------------------------

Subtotal: â‚¹xxx
Previous Due: â‚¹xxx
Grand Total: â‚¹xxx
Due Date: [date]

Status: [paid/unpaid/overdue]

ğŸ“Œ 7. FRONTEND LOGIC (React + TS)

Use React Query:

useQuery("billing", fetchUserBills)
useQuery(["bill", billId], fetchBillDetails)


Use shadcn components for:

Tables

Badges

Modals

Buttons

Cards

Mobile responsive
Clean green/blue Divine Naturals theme.

ğŸ“Œ 8. COMPLETE FLOW
STEP 1

Cron generates bill monthly

STEP 2

User sees bill in /billing

STEP 3

User pays CASH to shop owner

STEP 4

Admin opens /admin/billing

STEP 5

Admin marks bill as â€œpaidâ€

STEP 6

System cleans previous due
Next month bill calculates normally

ğŸ“Œ 9. FINAL OUTPUT (WHAT I EXPECT FROM REPLIT)

Replit must deliver:

âœ” Database tables
âœ” Bill generation backend
âœ” All APIs
âœ” User billing page
âœ” Admin billing control page
âœ” Full working CRUD
âœ” Cash-only payment flow
âœ” PDF invoice
âœ” Auto overdue status
âœ” Responsive UI
âœ” React Query integration
âœ” Tested with dummy data