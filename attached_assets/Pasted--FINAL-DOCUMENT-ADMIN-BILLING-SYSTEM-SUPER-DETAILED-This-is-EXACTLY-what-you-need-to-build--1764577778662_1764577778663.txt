‚úÖ FINAL DOCUMENT ‚Äî ADMIN BILLING SYSTEM (SUPER-DETAILED)

üëá This is EXACTLY what you need to build next for your ADMIN PANEL.
(Write this into Replit, and build step-by-step)

‚≠ê ADMIN BILLING SYSTEM ‚Äì FULL SPECIFICATION (EXTREME DETAIL)

(Designed for Divine Naturals ‚Äì Dairy Subscription + Orders Platform)

1Ô∏è‚É£ HIGH-LEVEL OVERVIEW

Your app already has:

Orders

Subscriptions

Products

Customers

Admin Panel

But you DO NOT YET have a full billing system.

Billing system =
üëâ Collect all monthly milk deliveries
üëâ Collect all one-time orders
üëâ Merge into ONE single monthly bill
üëâ User gets 5 days to pay
üëâ Admin can edit/waive/extend/manually mark paid

This is essential for any dairy business.

2Ô∏è‚É£ BILLING LOGIC ‚Äî HOW IT WORKS IN REAL LIFE
üìå Admin needs:

View all bills

Edit any bill

Add/remove charges

Extend due dates

Apply penalties

Mark as paid

Regenerate bill

üìå System needs:

Auto-generate monthly bills

Track overdue bills

Send reminders

Sync with subscriptions and orders

3Ô∏è‚É£ BACKEND SYSTEM FLOW (EXTREMELY DETAILED)

Here is the full lifecycle:

                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ 1. End of Month Cron   ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ 2. Fetch all users     ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ 3. For each user:                        ‚îÇ
         ‚îÇ - get all subscription deliveries        ‚îÇ
         ‚îÇ - get all orders of that month           ‚îÇ
         ‚îÇ - add previous pending amount            ‚îÇ
         ‚îÇ - create bill document                   ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ 4. Save bill in DB     ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ 5. Notify user         ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

4Ô∏è‚É£ DATABASE MODELS (MUST CREATE THESE)
üìç billing.model.ts
{
  _id: ObjectId,
  userId: ObjectId,      
  month: Number,          // 1‚Äì12
  year: Number,           // 2025
  items: [
    {
      type: "subscription" | "order",
      productId: ObjectId,
      productName: String,
      quantity: Number,          // litres or units
      pricePerUnit: Number,
      total: Number,
      date: Date
    }
  ],
  subscriptionTotal: Number,
  ordersTotal: Number,
  previousPending: Number,
  penalty: Number,
  discount: Number,
  finalAmount: Number,
  dueDate: Date,
  status: "unpaid" | "paid" | "overdue",
  createdAt: Date,
  updatedAt: Date
}

5Ô∏è‚É£ ADMIN BILLING PANEL ‚Äî FULL STRUCTURE
Route:
/admin/billing

6Ô∏è‚É£ UI SECTIONS (EXTREME DETAIL)
üìå 6.1 BILLING DASHBOARD HOME
Top Header:
üìë Billing Management
Last Updated: [time ago]
[Refresh]

6 KPI Cards
Card	Data	Color
Total Bills	[Count]	Blue
Unpaid Bills	[Count]	Red
Paid Bills	[Count]	Green
Overdue Bills	[Count]	Orange
Revenue Collected	‚ÇπAmount	Purple
Pending Revenue	‚ÇπAmount	Orange
üìå 6.2 BILLING TABLE (MAIN TABLE)
# | User | Month | Total Amount | Status | Due Date | Actions

Row Example:
1 | Rohan Sharma | Jan 2025 | ‚Çπ2,450 | üî¥ Unpaid | 05 Feb | [View] [Edit] [Mark Paid]

7Ô∏è‚É£ ADMIN BILL DETAILS PAGE (SUPER DETAILED)

Route:

/admin/billing/:billId


Page Layout:

üìå SECTION A ‚Äî BILL SUMMARY CARD

User Name

Bill Period

Subscription Amount

Orders Amount

Previous Pending

Penalty

Discount

Total Payable

Status

Due Date

UI Example:

-----------------------------------------
|  User: Rohan Sharma                    |
|  Month: January 2025                   |
|  Subscription Total: ‚Çπ1,800            |
|  Orders Total: ‚Çπ650                    |
|  Previous Pending: ‚Çπ400                |
|  Penalty: ‚Çπ50                          |
|  Discount: ‚Çπ0                          |
|----------------------------------------|
|  Final Amount: ‚Çπ2,900                  |
|  Status: UNPAID                        |
|  Due Date: 05 Feb 2025                 |
-----------------------------------------

üìå SECTION B ‚Äî ITEMS BREAKDOWN TABLE
Type | Product | Qty | Price | Total | Date


Example:

Subscription | Cow Milk | 30L | ‚Çπ60 | ‚Çπ1800 | Daily
Order        | Ghee 1L  | 1   | ‚Çπ650| ‚Çπ650  | 15 Jan

8Ô∏è‚É£ ADMIN ACTIONS (MUST BUILD FULLY)

Admin can:

üìå A. Mark Bill as Paid

Flow:

Update bill.status = "paid"
Update user.pendingAmount = 0
Send user receipt

üìå B. Extend Due Date

Popup:

Enter new due date: [date picker]
[Save]

üìå C. Add Penalty

Popup:

Enter penalty amount: ‚Çπ[input]
[Save]

üìå D. Add Discount / Waive Charges

Popup:

Enter discount amount: ‚Çπ[input]
[Save]

üìå E. Regenerate Bill

This recalculates everything.

Flow:

Delete old items[]
Fetch all orders + subscription logs again
Recalculate totals
Recalculate pending
Save new bill version

üìå F. Delete Bill

Only if unpaid.

9Ô∏è‚É£ BACKEND APIs (FULL WORKING LOGIC)
üìå Create Bill (cron job)

POST /api/billing/generate

üìå Get all bills

GET /api/billing

üìå Get bill by ID

GET /api/billing/:id

üìå Update bill

PATCH /api/billing/:id

üìå Add penalty

PATCH /api/billing/:id/penalty

üìå Add discount

PATCH /api/billing/:id/discount

üìå Extend due date

PATCH /api/billing/:id/extend

üìå Mark bill as paid

PATCH /api/billing/:id/paid

üîü PAYMENT LOGIC

If user pays online:

Razorpay verifies payment

bill.status = "paid"

user.pendingAmount resets

Invoice stored in /billing/invoices

1Ô∏è‚É£1Ô∏è‚É£ MONTH-END CRON LOGIC (MUST BUILD)

Runs every month:

0 0 1 * *   (1st date midnight)


Flow:

Fetch all users

For each user:

collect subscription deliveries

collect one-time orders

add previous pending

generate bill

Save bill

Notify user

1Ô∏è‚É£2Ô∏è‚É£ NOTIFICATION SYSTEM

Day 1:

Your monthly bill is ready.
Total Due: ‚Çπ____
Please pay within 5 days.


Day 3:

Reminder: Your bill is still unpaid!


Day 5:

Final Reminder: Today is last day to pay.


Day 6:

Bill marked as overdue.
Penalty may apply.

1Ô∏è‚É£3Ô∏è‚É£ ADMIN VIEWS (UI HIERARCHY)
Billing
‚îú‚îÄ‚îÄ Dashboard
‚îú‚îÄ‚îÄ All Bills
‚îÇ     ‚îú‚îÄ‚îÄ Paid
‚îÇ     ‚îú‚îÄ‚îÄ Unpaid
‚îÇ     ‚îú‚îÄ‚îÄ Overdue
‚îú‚îÄ‚îÄ Bill Detail
‚îÇ     ‚îú‚îÄ‚îÄ Summary
‚îÇ     ‚îú‚îÄ‚îÄ Items Table
‚îÇ     ‚îú‚îÄ‚îÄ Admin Actions
‚îÇ     ‚îî‚îÄ‚îÄ Payment History
‚îî‚îÄ‚îÄ Settings
      ‚îú‚îÄ‚îÄ Auto Penalty Rules
      ‚îú‚îÄ‚îÄ Auto Reminder Rules
      ‚îú‚îÄ‚îÄ Tax Settings

1Ô∏è‚É£4Ô∏è‚É£ EXTRA FEATURES ADMIN CAN ADD LATER (OPTIONAL)

‚úî Export to Excel
‚úî Tax/GST
‚úî SMS alerts
‚úî Auto penalty rules
‚úî Auto lock account if >30 days unpaid
‚úî Reward points for timely payment

1Ô∏è‚É£5Ô∏è‚É£ WHAT YOU SHOULD BUILD FIRST (ORDER)
PHASE 1 ‚Äî CORE (Must complete before anything else)

Billing database model

Cron job: generate bill

Admin Billing Dashboard

Admin Bill Detail Page

Admin Actions: Mark Paid, Extend, Penalty, Discount

PHASE 2 ‚Äî USER SIDE

User Billing Page (/billing)

User see current bill

User pay online

User download invoice